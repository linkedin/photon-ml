def jobDir = "conf/jobs"

// Have this script clean up the jobDir on ligradle clean.
clean {
  delete jobDir
}

def flowName = "generate-all-feature-lists-on-yahoo-music-data-nertzrm02"

// For generating feature list
def featureSectionKeys = "features,userFeatures,songFeatures"
def featureNameAndTermSetOutputPath = "/jobs/fastrain/glmix_data/extended-yahoo-music-rank100-lambda0.05/feature-lists"
def inputDirs = "/jobs/fastrain/glmix_data/extended-yahoo-music-rank100-lambda0.05/train"

hadoop {
  buildPath jobDir

  workflow(flowName) {

    job("standalone-job") {

      def numExecutors = 50
      def executorMemory= '10G'
      def driverMemory= '10G'
      def parallelism=numExecutors*4

      baseProperties 'sparkCommon'
      set properties: [
        'class'                          : 'com.linkedin.photon.ml.avro.data.NameAndTermFeatureSetContainer',
        'num-executors'                  : numExecutors,
        'driver-memory'                  : driverMemory,
        'executor-memory'                : executorMemory,
        'conf.spark.default.parallelism' : parallelism,
        'params' : "--data-input-directory $inputDirs " +
            "--feature-name-and-term-set-output-dir $featureNameAndTermSetOutputPath " +
            "--feature-section-keys $featureSectionKeys " +
            "--application-name generate-all-feature-lists "
      ]
    }
    targets "standalone-job"
  }
}
